<!-- <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super GPA Calc | Elite Academic Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        :root {
            --primary: #0f172a;
            --accent: #2563eb;
            --success: #059669;
            --danger: #dc2626;
            --bg: #f8fafc;
            --card: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --sup-blue: #1e3a8a;
            --sup-light: #3b82f6;
        }

        * {
            box-sizing: border-box;
            font-family: 'Plus Jakarta Sans', sans-serif;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            background: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            width: 100%;
        }

        /* --- AUTH DYNAMIC LAYOUT --- */
        #authPage {
            display: flex;
            min-height: 100vh;
            width: 100%;
            background: #fff;
            overflow-x: hidden;
        }

        .auth-side {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 5%;
            position: relative;
            z-index: 2;
            width: 100%;
        }

        .branding-side {
            background: linear-gradient(135deg, var(--sup-blue) 0%, var(--sup-light) 100%);
            color: white;
            text-align: left;
            align-items: flex-start;
        }

        .branding-content {
            max-width: 500px;
            width: 100%;
        }

        .branding-content h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 800;
            margin-bottom: 20px;
            line-height: 1.1;
            letter-spacing: -2px;
        }

        .branding-content p {
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            opacity: 0.85;
            margin-bottom: 35px;
            line-height: 1.6;
        }

        .product-card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
            width: 100%;
        }

        .p-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
        }

        .p-card h4 {
            margin: 0 0 8px 0;
            font-size: 14px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .p-card p {
            margin: 0;
            font-size: 11px;
            opacity: 0.75;
            line-height: 1.4;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 30px;
            width: fit-content;
        }

        .stat-item span {
            display: block;
            font-size: 22px;
            font-weight: 800;
        }

        .stat-item label {
            font-size: 10px;
            text-transform: uppercase;
            opacity: 0.7;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .form-side {
            background: #fff;
        }

        .form-container {
            width: 100%;
            max-width: 400px;
        }

        .form-container h2 {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        .input-group {
            position: relative;
            margin-bottom: 20px;
            width: 100%;
        }

        .input-group label {
            display: block;
            font-size: 11px;
            font-weight: 800;
            color: var(--text-muted);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .auth-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border);
            border-radius: 20px;
            outline: none;
            font-size: 15px;
            background: #f8fafc;
        }

        .auth-input:focus {
            border-color: var(--accent);
            background: #fff;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        .eye-toggle {
            position: absolute;
            right: 20px;
            bottom: 16px;
            cursor: pointer;
            color: var(--text-muted);
            font-size: 18px;
        }

        .auth-btn {
            width: 100%;
            padding: 18px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 20px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 15px;
            font-size: 16px;
        }

        .auth-switch {
            margin-top: 25px;
            font-size: 14px;
            color: var(--text-muted);
            text-align: center;
        }

        .auth-switch span {
            color: var(--accent);
            font-weight: 800;
            cursor: pointer;
            text-decoration: underline;
        }

        #authPage.register-mode {
            flex-direction: row-reverse;
        }

        /* --- DASHBOARD UI --- */
        #mainDashboard {
            display: none;
            padding: 5vw 20px;
            width: 100%;
        }

        .container {
            max-width: 1250px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .glass-header {
            background: linear-gradient(135deg, var(--sup-blue) 0%, var(--sup-light) 100%);
            padding: clamp(30px, 5vw, 60px);
            border-radius: clamp(25px, 4vw, 45px);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: 0 30px 60px -15px rgba(30, 58, 138, 0.3);
        }

        .header-content {
            flex: 1;
            min-width: 250px;
        }

        .cgpa-display {
            text-align: right;
            min-width: 200px;
        }

        .cgpa-val {
            font-size: clamp(40px, 10vw, 80px);
            font-weight: 800;
            line-height: 1;
            letter-spacing: -4px;
            margin-bottom: 5px;
        }

        .credits-tag {
            font-size: 13px;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 20px;
            border-radius: 50px;
            display: inline-block;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .info-card {
            background: var(--card);
            padding: 25px;
            border-radius: 25px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.02);
        }

        .email-display-box {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f1f5f9;
            padding: 12px 18px;
            border-radius: 18px;
            margin-top: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .email-text {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary);
        }

        .email-toggle-btn {
            cursor: pointer;
            color: white;
            background: var(--accent);
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
        }

        .actions-bar {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            background: #fff;
            padding: 12px;
            border-radius: 20px;
            border: 1px solid var(--border);
            width: fit-content;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 14px;
            border: none;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-sync {
            background: #6366f1;
            color: white;
        }

        .btn-export {
            background: var(--danger);
            color: white;
        }

        .btn-clear {
            background: transparent;
            border: 2px solid #cbd5e1;
            color: #64748b;
        }

        .btn-clear:hover {
            border-color: var(--danger);
            color: var(--danger);
            background: #fef2f2;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text-main);
        }

        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
        }

        .sem-card {
            background: var(--card);
            border-radius: clamp(25px, 4vw, 40px);
            padding: clamp(20px, 4vw, 40px);
            border: 1px solid var(--border);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.02);
        }

        .sem-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .sem-badge {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 200px;
        }

        .sem-id-circle {
            background: var(--primary);
            color: white;
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-weight: 800;
            font-size: 16px;
            flex-shrink: 0;
        }

        .sem-title-input {
            font-size: clamp(18px, 3vw, 22px);
            font-weight: 800;
            border: none;
            outline: none;
            color: var(--primary);
            background: transparent;
            width: 100%;
            max-width: 250px;
        }

        .sgpa-pill {
            background: #eff6ff;
            color: var(--accent);
            padding: 10px 20px;
            border-radius: 15px;
            font-weight: 800;
            font-size: 15px;
            border: 1.5px solid #dbeafe;
        }

        .table-wrap {
            overflow-x: auto;
            border-radius: 20px;
            border: 1.5px solid var(--border);
            -webkit-overflow-scrolling: touch;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }

        th {
            background: #f8fafc;
            padding: 18px;
            text-align: left;
            font-size: 11px;
            font-weight: 800;
            color: var(--text-muted);
            text-transform: uppercase;
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 14px 18px;
            border-bottom: 1.5px solid #f1f5f9;
            background: #fff;
        }

        input.cell-input {
            width: 100%;
            padding: 10px 14px;
            border: 1.5px solid var(--border);
            border-radius: 12px;
            font-size: 13px;
            outline: none;
        }

        .btn-order {
            background: #f1f5f9;
            border: none;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            color: #64748b;
        }

        .btn-order:hover {
            background: var(--accent);
            color: white;
        }

        .btn-delete-subject {
            color: #ef4444;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 800;
            padding: 8px;
            border-radius: 10px;
            font-size: 16px;
        }

        .btn-delete-subject:hover {
            background-color: #fde047 !important;
            color: #b91c1c;
        }

        .grade-tag {
            padding: 6px 12px;
            border-radius: 10px;
            color: white;
            font-weight: 800;
            font-size: 11px;
            display: inline-block;
            min-width: 45px;
            text-align: center;
        }

        .add-sem-btn-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            border-radius: 35px;
            border: 3px dashed var(--border);
            cursor: pointer;
            background: rgba(241, 245, 249, 0.4);
            order: 999;
            margin-bottom: 60px;
            text-align: center;
        }

        .add-sem-btn-container:hover {
            background: #fff;
            border-color: var(--accent);
        }

        .add-sem-text {
            font-size: 16px;
            font-weight: 800;
            color: var(--text-muted);
        }

        /* --- RESPONSIVE ADJUSTMENTS --- */
        @media (max-width: 1024px) {
            #authPage {
                flex-direction: column !important;
                height: auto;
            }

            .auth-side {
                padding: 60px 20px;
            }

            .branding-side {
                text-align: center;
                align-items: center;
            }

            .branding-content {
                text-align: center;
            }

            .branding-content h1 {
                letter-spacing: -1px;
            }

            .stat-item {
                margin: 30px auto 0;
            }
        }

        @media (max-width: 768px) {
            .glass-header {
                flex-direction: column;
                text-align: center;
                padding: 30px 20px;
            }

            .cgpa-display {
                text-align: center;
            }

            .actions-bar {
                width: 100%;
                justify-content: center;
            }

            .btn {
                flex: 1;
                justify-content: center;
                min-width: 140px;
            }

            #mainDashboard {
                padding: 30px 15px;
            }

            .container {
                gap: 20px;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .branding-content h1 {
                font-size: 28px;
            }

            .cgpa-val {
                font-size: 50px;
            }

            .sem-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .sgpa-pill {
                align-self: flex-start;
                width: 100%;
                text-align: center;
            }

            .add-sem-btn-container {
                padding: 30px;
            }

            .actions-bar {
                padding: 8px;
                gap: 8px;
                border-radius: 15px;
            }

            .btn {
                padding: 10px;
                font-size: 12px;
            }
        }

        @media print {

            .no-print,
            .btn-order,
            .auth-wrapper,
            .add-sem-btn-container {
                display: none !important;
            }
        }
    </style>
</head>

<body>

    <div id="authPage">
        <div class="auth-side branding-side" id="brandingPanel">
            <div class="branding-content">
                <h1 id="brandTitle">Master Your Academic Journey.</h1>
                <p id="brandDesc">Precision-engineered for Superior University students. Track your progress with
                    ERP-synced accuracy.</p>
                <div class="product-card-grid" id="productGrid">
                    <div class="p-card">
                        <h4>‚ö° Quick PDF Sync</h4>
                        <p>Import official result cards in one click with our advanced engine.</p>
                    </div>
                    <div class="p-card">
                        <h4>üìä ERP Precision</h4>
                        <p>Calculations strictly aligned with official grading points.</p>
                    </div>
                    <div class="p-card">
                        <h4>‚ÜïÔ∏è Sequence Control</h4>
                        <p>Organize courses exactly how they appear on your transcript.</p>
                    </div>
                    <div class="p-card">
                        <h4>üì± Mobile Optimized</h4>
                        <p>Manage your grades anywhere with an app-like responsive interface.</p>
                    </div>
                </div>
                <div class="stat-item"><span>100%</span><label>ERP Sync Accuracy</label></div>
            </div>
        </div>
        <div class="auth-side form-side">
            <div class="form-container" id="loginForm">
                <h2>Welcome Back</h2>
                <p style="margin-bottom:30px">Sign in to Super GPA Calc portal.</p>
                <div class="input-group"><label>Official Email</label><input type="email" id="loginEmail"
                        class="auth-input" placeholder="id@superior.edu.pk"></div>
                <div class="input-group"><label>Password</label><input type="password" id="loginPass" class="auth-input"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"><span class="eye-toggle"
                        onclick="togglePass('loginPass', this)">üëÅÔ∏è</span></div>
                <button class="auth-btn" onclick="handleAuth('login')">Sign In to Dashboard</button>
                <p class="auth-switch">New here? <span onclick="toggleAuthMode('register')">Create Account</span></p>
            </div>
            <div class="form-container" id="regForm" style="display: none;">
                <h2>Get Started</h2>
                <p style="margin-bottom:30px">Initialize your elite academic profile.</p>
                <div class="input-group"><label>Superior Email</label><input type="email" id="regEmail"
                        class="auth-input" placeholder="id@superior.edu.pk"></div>
                <div class="input-group"><label>Password</label><input type="password" id="regPass" class="auth-input"
                        placeholder="Min. 6 characters"><span class="eye-toggle"
                        onclick="togglePass('regPass', this)">üëÅÔ∏è</span></div>
                <button class="auth-btn" style="background:var(--success)" onclick="handleAuth('signup')">Register My
                    Account</button>
                <p class="auth-switch">Already have an account? <span onclick="toggleAuthMode('login')">Login
                        Here</span></p>
            </div>
        </div>
    </div>

    <div id="mainDashboard">
        <div class="container">
            <div class="glass-header">
                <div class="header-content">
                    <h1 style="margin:0; font-size: clamp(24px, 4vw, 36px); font-weight: 800;">Super GPA Calc</h1>
                    <p style="margin:5px 0 0 0; opacity: 0.9; font-weight: 500;">Official Superior ERP Grade System</p>
                </div>
                <div class="cgpa-display">
                    <div
                        style="font-size: 11px; font-weight: 800; text-transform: uppercase; opacity: 0.9; letter-spacing: 1px;">
                        Calculated CGPA</div>
                    <div id="cgpaVal" class="cgpa-val">0.00</div>
                    <div id="degreeStatus" class="credits-tag">Total Earned Credits: 0</div>
                </div>
            </div>

            <div class="info-grid">
                <div class="info-card">
                    <label>Verified Student Profile</label>
                    <div class="email-display-box">
                        <div id="userEmailTag" class="email-text">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                        <div class="email-toggle-btn" onclick="toggleEmailDisplay(this)">Show Email</div>
                    </div>
                </div>
                <div class="info-card">
                    <label>System Authentication</label>
                    <div class="email-text" style="color: var(--success); font-size: clamp(16px, 3vw, 20px);">‚úì Official
                        Access Verified</div>
                </div>
            </div>

            <div class="actions-bar no-print">
                <button class="btn btn-success" onclick="document.getElementById('fileInput').click()">üìÅ Excel</button>
                <button class="btn btn-sync" onclick="document.getElementById('pdfInput').click()">üìÑ Sync PDF</button>
                <button class="btn btn-export" onclick="window.print()">üñ®Ô∏è PDF Report</button>
                <button class="btn btn-clear" onclick="clearAll()">üóëÔ∏è Clear</button>
                <button class="btn btn-outline" onclick="logout()">üö™ Sign Out</button>
                <input type="file" id="fileInput" accept=".xlsx, .xls, .csv" style="display:none">
                <input type="file" id="pdfInput" accept=".pdf" style="display:none">
            </div>

            <div id="semContainer" style="display: flex; flex-direction: column; gap: 30px;"></div>

            <div class="add-sem-btn-container no-print" onclick="addSemester()">
                <div>
                    <div style="font-size: 36px; color: var(--accent); margin-bottom: 5px;">+</div><span
                        class="add-sem-text">Create New Semester Block</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // 2.55 ERP Sync Logic
        const gradingPlan = [
            { min: 85, g: "A", p: 4.00, c: "#059669" }, { min: 80, g: "A-", p: 3.66, c: "#10b981" },
            { min: 75, g: "B+", p: 3.33, c: "#2563eb" }, { min: 71, g: "B", p: 3.00, c: "#3b82f6" },
            { min: 68, g: "B-", p: 2.66, c: "#1d4ed8" }, { min: 64, g: "C+", p: 2.33, c: "#ea580c" },
            { min: 61, g: "C", p: 2.00, c: "#f59e0b" }, { min: 58, g: "C-", p: 1.66, c: "#d97706" },
            { min: 54, g: "D+", p: 1.30, c: "#92400e" }, { min: 50, g: "D", p: 1.00, c: "#78350f" },
            { min: 0, g: "F", p: 0.00, c: "#dc2626" }
        ];

        let users = JSON.parse(localStorage.getItem('supGpaUsers')) || {};
        let activeEmail = sessionStorage.getItem('activeSupEmail');
        let semesterData = [];
        let isEmailVisible = false;

        // --- AUTH UI ---
        function toggleAuthMode(mode) {
            const authPage = document.getElementById('authPage');
            const loginForm = document.getElementById('loginForm');
            const regForm = document.getElementById('regForm');
            const brandTitle = document.getElementById('brandTitle');
            const brandDesc = document.getElementById('brandDesc');
            const productGrid = document.getElementById('productGrid');

            if (mode === 'register') {
                authPage.classList.add('register-mode');
                loginForm.style.display = 'none'; regForm.style.display = 'block';
                brandTitle.innerText = "Empower Your Academic Future.";
                brandDesc.innerText = "Join the elite Super GPA Calc dashboard. Designed for accuracy.";
                productGrid.innerHTML = `<div class="p-card"><h4>üîí Data Privacy</h4><p>Records are encrypted locally for security.</p></div><div class="p-card"><h4>üõ°Ô∏è Official Access</h4><p>Restricted to @superior.edu.pk email holders.</p></div><div class="p-card"><h4>‚úÖ Verified Logic</h4><p>Synced with official portal grading points.</p></div><div class="p-card"><h4>‚ö° Smooth UI</h4><p>Modern app-like transitions on all devices.</p></div>`;
            } else {
                authPage.classList.remove('register-mode');
                loginForm.style.display = 'block'; regForm.style.display = 'none';
                brandTitle.innerText = "Master Your Academic Journey.";
                brandDesc.innerText = "Precision-engineered for Superior University students.";
                productGrid.innerHTML = `<div class="p-card"><h4>‚ö° Quick PDF Sync</h4><p>Import official result cards in one click.</p></div><div class="p-card"><h4>üìä ERP Precision</h4><p>Calculations strictly aligned with portal points.</p></div><div class="p-card"><h4>‚ÜïÔ∏è Sequence Control</h4><p>Organize courses exactly as on transcript.</p></div><div class="p-card"><h4>üì± Mobile Optimized</h4><p>Responsive, app-like interface.</p></div>`;
            }
        }

        function togglePass(id, el) {
            const input = document.getElementById(id);
            if (input.type === "password") { input.type = "text"; el.innerText = "üîí"; }
            else { input.type = "password"; el.innerText = "üëÅÔ∏è"; }
        }

        function toggleEmailDisplay(el) {
            const tag = document.getElementById('userEmailTag');
            if (isEmailVisible) { tag.innerText = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"; el.innerText = "Show Email"; isEmailVisible = false; }
            else { tag.innerText = activeEmail; el.innerText = "Hide Email"; isEmailVisible = true; }
        }

        function handleAuth(type) {
            const email = document.getElementById(type === 'login' ? 'loginEmail' : 'regEmail').value.trim().toLowerCase();
            const pass = document.getElementById(type === 'login' ? 'loginPass' : 'regPass').value;
            if (!email.endsWith('@superior.edu.pk')) return alert("Use @superior.edu.pk email!");
            if (pass.length < 6) return alert("Password must be 6+ chars!");
            if (type === 'signup') {
                if (users[email]) return alert("Account exists!");
                users[email] = { password: pass, semesters: [] };
                localStorage.setItem('supGpaUsers', JSON.stringify(users));
                alert("Registered! Now Login."); toggleAuthMode('login');
            } else {
                if (users[email] && users[email].password === pass) {
                    activeEmail = email; sessionStorage.setItem('activeSupEmail', email);
                    initDashboard();
                } else { alert("Invalid credentials!"); }
            }
        }

        function initDashboard() {
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('mainDashboard').style.display = 'block';
            semesterData = users[activeEmail].semesters || [];
            render();
        }

        function logout() { sessionStorage.clear(); location.reload(); }
        function saveAndRender() { users[activeEmail].semesters = semesterData; localStorage.setItem('supGpaUsers', JSON.stringify(users)); render(); }
        function clearAll() { if (confirm('Clear ALL records?')) { semesterData = []; saveAndRender(); } }

        function moveSub(semId, idx, direction) {
            const sem = semesterData.find(s => s.id === semId);
            const target = idx + direction;
            if (target >= 0 && target < sem.subjects.length) { [sem.subjects[idx], sem.subjects[target]] = [sem.subjects[target], sem.subjects[idx]]; saveAndRender(); }
        }

        function addSemester() { semesterData.push({ id: Date.now() + Math.random(), name: `Semester ${semesterData.length + 1}`, subjects: [] }); saveAndRender(); }
        function addSubject(semId) { semesterData.find(s => s.id === semId).subjects.push({ code: '', title: '', ch: 3, marks: 0 }); saveAndRender(); }
        function updateVal(semId, subIdx, field, val) { const sem = semesterData.find(s => s.id === semId); sem.subjects[subIdx][field] = (field === 'title' || field === 'code') ? val : parseFloat(val || 0); saveAndRender(); }
        function deleteSub(semId, idx) { semesterData.find(s => s.id === semId).subjects.splice(idx, 1); saveAndRender(); }
        function deleteSem(id) { if (confirm('Delete block?')) { semesterData = semesterData.filter(s => s.id !== id); saveAndRender(); } }

        async function handlePdfUpload(e) {
            const file = e.target.files[0]; if (!file) return;
            const pdf = await pdfjsLib.getDocument(new Uint8Array(await file.arrayBuffer())).promise;
            let fullText = "";
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                fullText += (await page.getTextContent()).items.map(s => s.str).join(" ") + " ";
            }
            const sections = fullText.split(/Term:\s+/);
            sections.slice(1).forEach(section => {
                const words = section.trim().split(" ");
                const semester = { id: Date.now() + Math.random(), name: words[0] + " " + words[1], subjects: [] };
                const rowRegex = /(\d+)\s+([A-Z0-9]{6,12})\s+(.+?)\s+(\d\.\d{2})\s+(\d+)\s+(\d+)\s+([A-F][+-]?)/g;
                let m; while ((m = rowRegex.exec(section)) !== null) {
                    if (!m[3].includes("Course Title")) semester.subjects.push({ code: m[2], title: m[3].trim(), ch: parseFloat(m[4]), marks: parseFloat(m[6]) });
                }
                if (semester.subjects.length > 0) semesterData.push(semester);
            });
            saveAndRender();
            alert("Sync Complete!");
        }

        function render() {
            const container = document.getElementById('semContainer');
            container.innerHTML = '';
            let totalQP = 0, totalCH = 0;

            semesterData.forEach((sem, index) => {
                let semCH = 0, semQP = 0;
                const rowsHtml = sem.subjects.map((sub, i) => {
                    const grade = gradingPlan.find(p => sub.marks >= p.min) || gradingPlan[10];
                    const qp = sub.ch * grade.p; semCH += sub.ch; semQP += qp;
                    return `<tr>
                    <td class="no-print"><div class="order-controls"><button class="btn-order" onclick="moveSub(${sem.id},${i},-1)">‚Üë</button><button class="btn-order" onclick="moveSub(${sem.id},${i},1)">‚Üì</button></div></td>
                    <td><input class="cell-input" type="text" value="${sub.code}" onchange="updateVal(${sem.id},${i},'code',this.value)"></td>
                    <td><input class="cell-input" type="text" value="${sub.title}" onchange="updateVal(${sem.id},${i},'title',this.value)"></td>
                    <td><input class="cell-input" type="number" value="${sub.ch}" onchange="updateVal(${sem.id},${i},'ch',this.value)"></td>
                    <td><input class="cell-input" type="number" value="${sub.marks}" onchange="updateVal(${sem.id},${i},'marks',this.value)"></td>
                    <td><span class="grade-tag" style="background:${grade.c}">${grade.g}</span></td>
                    <td style="font-weight:700;">${grade.p.toFixed(2)}</td>
                    <td style="font-weight:800; color:var(--accent)">${qp.toFixed(2)}</td>
                    <td class="no-print"><button class="btn-delete-subject" onclick="deleteSub(${sem.id},${i})">‚úï</button></td>
                </tr>`;
                }).join('');

                const sgpa = semCH > 0 ? (semQP / semCH) : 0;
                totalCH += semCH; totalQP += semQP;

                const card = document.createElement('div'); card.className = 'sem-card';
                card.innerHTML = `<div class="sem-header"><div class="sem-badge"><div class="sem-id-circle">${index + 1}</div><input class="sem-title-input" value="${sem.name}" onchange="semesterData.find(x=>x.id===${sem.id}).name=this.value;saveAndRender()"></div><div class="sgpa-pill">SGPA: ${sgpa.toFixed(2)}</div><button class="no-print" style="color:var(--danger);background:none;border:none;cursor:pointer;font-weight:700" onclick="deleteSem(${sem.id})">Delete</button></div><div class="table-wrap"><table><thead><tr><th class="no-print">Move</th><th>Code</th><th>Course</th><th>CH</th><th>Marks</th><th>Grade</th><th>GP</th><th>QP</th><th class="no-print"></th></tr></thead><tbody>${rowsHtml}</tbody></table></div><button class="btn no-print" style="background:var(--bg); color:var(--accent); width:100%; border:2px dashed var(--border); margin-top:25px; justify-content:center; padding:15px; border-radius:20px; font-weight:800; cursor:pointer;" onclick="addSubject(${sem.id})">+ Add Course Entry</button>`;
                container.appendChild(card);
            });

            document.getElementById('cgpaVal').innerText = (totalCH > 0 ? (totalQP / totalCH) : 0).toFixed(2);
            document.getElementById('degreeStatus').innerText = `Credits: ${totalCH}`;
        }

        document.getElementById('fileInput').addEventListener('change', (e) => {
            const reader = new FileReader(); reader.onload = (ev) => {
                const rows = XLSX.utils.sheet_to_json(XLSX.read(new Uint8Array(ev.target.result), { type: 'array' }).Sheets[XLSX.read(new Uint8Array(ev.target.result), { type: 'array' }).SheetNames[0]]);
                const grouped = {}; rows.forEach(row => {
                    const vals = Object.values(row); const term = row['Term'] || vals[0]; if (!term || isNaN(parseFloat(vals[3]))) return;
                    if (!grouped[term]) grouped[term] = [];
                    grouped[term].push({ code: row['Course Code'] || vals[1] || '', title: row['Course Title'] || vals[2] || '', ch: parseFloat(vals[3]), marks: parseFloat(vals[4]) || 0 });
                });
                Object.keys(grouped).forEach(term => { semesterData.push({ id: Date.now() + Math.random(), name: term, subjects: grouped[term] }); });
                saveAndRender();
            }; reader.readAsArrayBuffer(e.target.files[0]);
        });
        document.getElementById('pdfInput').addEventListener('change', handlePdfUpload);
        if (activeEmail) initDashboard();
    </script>
</body>

</html> -->

<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super GPA Calc | Elite Academic Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        :root {
            --primary: #0f172a; --accent: #2563eb; --success: #059669;
            --danger: #dc2626; --bg: #f8fafc; --card: #ffffff;
            --text-main: #1e293b; --text-muted: #64748b; --border: #e2e8f0;
            --sup-blue: #1e3a8a; --sup-light: #3b82f6; --warning-bg: #fffbeb;
        }
        * { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        body { background: var(--bg); color: var(--text-main); margin: 0; padding: 0; overflow-x: hidden; }

        /* --- AUTH SYSTEM --- */
        #authPage { display: flex; min-height: 100vh; width: 100%; background: #fff; overflow: hidden; }
        .auth-side { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 5%; width: 100%; }
        .branding-side { background: linear-gradient(135deg, var(--sup-blue) 0%, var(--sup-light) 100%); color: white; text-align: left; align-items: flex-start; }
        .branding-content { max-width: 480px; }
        .branding-content h1 { font-size: clamp(2rem, 5vw, 3rem); font-weight: 800; margin-bottom: 20px; line-height: 1.1; letter-spacing: -2px; }
        .p-card { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.15); margin-bottom: 15px; }
        .auth-input { width: 100%; padding: 16px; border: 2px solid var(--border); border-radius: 20px; outline: none; margin-bottom: 15px; font-size: 15px; }
        .auth-btn { width: 100%; padding: 18px; background: var(--accent); color: white; border: none; border-radius: 20px; font-weight: 700; cursor: pointer; font-size: 16px; }
        .eye-toggle { position: absolute; right: 20px; bottom: 16px; cursor: pointer; color: var(--text-muted); font-size: 18px; }
        #authPage.register-mode { flex-direction: row-reverse; }

        /* --- DASHBOARD UI --- */
        #mainDashboard { display: none; padding: 40px 20px; }
        .container { max-width: 1250px; margin: 0 auto; display: flex; flex-direction: column; gap: 30px; }
        .glass-header { background: linear-gradient(135deg, var(--sup-blue) 0%, var(--sup-light) 100%); padding: 50px; border-radius: 45px; color: white; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; box-shadow: 0 35px 50px -15px rgba(30, 58, 138, 0.4); }
        .cgpa-val { font-size: clamp(40px, 8vw, 80px); font-weight: 800; letter-spacing: -4px; }

        .identity-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .id-card { background: white; padding: 25px 30px; border-radius: 25px; border: 1px solid var(--border); box-shadow: 0 10px 20px rgba(0,0,0,0.02); }
        .email-display { display: flex; align-items: center; justify-content: space-between; background: #f1f5f9; padding: 12px 18px; border-radius: 18px; margin-top: 10px; }
        
        .actions-bar { display: flex; gap: 12px; flex-wrap: wrap; background: #fff; padding: 12px; border-radius: 20px; border: 1px solid var(--border); width: fit-content; }
        .btn { padding: 12px 24px; border-radius: 14px; border: none; font-weight: 700; cursor: pointer; font-size: 13px; }

        /* Subject Cards */
        .sem-card { background: white; border-radius: 40px; padding: clamp(20px, 4vw, 40px); border: 1px solid var(--border); box-shadow: 0 15px 30px rgba(0,0,0,0.03); margin-bottom: 30px; }
        .subject-block { background: #fcfcfd; border: 1.5px solid var(--border); border-radius: 30px; padding: 25px; margin-bottom: 25px; position: relative; }
        
        .mode-toggle { display: flex; background: #f1f5f9; padding: 5px; border-radius: 12px; width: fit-content; }
        .mode-btn { padding: 8px 16px; border-radius: 8px; border: none; font-size: 12px; font-weight: 700; cursor: pointer; background: transparent; color: var(--text-muted); }
        .mode-btn.active { background: white; color: var(--accent); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        .table-wrap { overflow-x: auto; border-radius: 18px; background: white; margin-top: 15px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 700px; }
        th { text-align: left; font-size: 11px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; padding: 15px; border-bottom: 1px solid var(--border); }
        td { padding: 12px 15px; border-bottom: 1px solid #f1f5f9; }
        .input-minimal { width: 100%; padding: 10px; border: 1.5px solid var(--border); border-radius: 10px; outline: none; font-size: 13px; }
        
        .warning-banner { background: var(--warning-bg); color: #92400e; padding: 12px; border-radius: 12px; font-size: 12px; font-weight: 700; margin-bottom: 15px; border: 1px solid #fde68a; }
        .add-sem-area { border: 2px dashed var(--border); padding: 45px; border-radius: 35px; text-align: center; cursor: pointer; font-weight: 800; color: var(--text-muted); margin-bottom: 60px; }
        .add-sem-area:hover { border-color: var(--accent); color: var(--accent); background: white; }

        @media (max-width: 1024px) { #authPage { flex-direction: column !important; } .auth-side { padding: 40px 20px; } }
    </style>
</head>
<body>

<div id="authPage">
    <div class="auth-side branding-side">
        <div class="branding-content">
            <h1>Master Your Academic Journey.</h1>
            <p>Advanced tracking for Superior students. Accurate ERP sync and modern assessments.</p>
            <div class="p-card"><h4>‚ö° Quick Sync</h4><p>Import official result cards and PDF transcripts instantly.</p></div>
            <div class="p-card"><h4>üìä Precision Math</h4><p>Calculations strictly follow official 2.55 CGPA logic.</p></div>
            <div class="stat-item"><span>100%</span><label>Accuracy Verified</label></div>
        </div>
    </div>
    <div class="auth-side form-side">
        <div class="form-container" id="loginForm">
            <h2 style="font-size: 32px; font-weight: 800; margin-bottom: 10px;">Sign In</h2>
            <div class="input-group"><input type="email" id="loginEmail" class="auth-input" placeholder="id@superior.edu.pk"></div>
            <div class="input-group" style="position:relative"><input type="password" id="loginPass" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"><span class="eye-toggle" onclick="togglePass('loginPass', this)">üëÅÔ∏è</span></div>
            <button class="auth-btn" onclick="handleAuth('login')">Login to Portal</button>
            <p style="text-align: center; margin-top: 20px; font-size: 14px; color: var(--text-muted);">New? <span onclick="toggleAuthMode('register')" style="color:var(--accent); font-weight:800; cursor:pointer;">Register</span></p>
        </div>
        <div class="form-container" id="regForm" style="display: none;">
            <h2 style="font-size: 32px; font-weight: 800; margin-bottom: 10px;">Register</h2>
            <div class="input-group"><input type="email" id="regEmail" class="auth-input" placeholder="id@superior.edu.pk"></div>
            <div class="input-group" style="position:relative"><input type="password" id="regPass" class="auth-input" placeholder="Min. 6 chars"><span class="eye-toggle" onclick="togglePass('regPass', this)">üëÅÔ∏è</span></div>
            <button class="auth-btn" style="background:var(--success)" onclick="handleAuth('signup')">Create Account</button>
            <p style="text-align: center; margin-top: 20px; font-size: 14px; color: var(--text-muted);">Have account? <span onclick="toggleAuthMode('login')" style="color:var(--accent); font-weight:800; cursor:pointer;">Login</span></p>
        </div>
    </div>
</div>

<div id="mainDashboard">
    <div class="container">
        <div class="glass-header">
            <div><h1 style="margin:0; font-size: clamp(24px, 4vw, 36px);">Super GPA Calc</h1><p style="opacity: 0.8; font-size: clamp(14px, 2vw, 18px);">Superior University Performance System</p></div>
            <div style="text-align: right;">
                <div style="font-size: 11px; font-weight: 800; text-transform: uppercase; opacity: 0.8; letter-spacing: 1px;">System CGPA</div>
                <div id="cgpaVal" class="cgpa-val">0.00</div>
                <div id="degreeStatus" style="font-size:13px; font-weight:700; background:rgba(255,255,255,0.2); padding:8px 18px; border-radius:30px; margin-top:10px; display:inline-block;">Credits: 0</div>
            </div>
        </div>

        <div class="identity-grid">
            <div class="id-card"><label style="font-size:10px; font-weight:800; color:var(--text-muted); text-transform:uppercase;">Active Student Email</label>
                <div class="email-display"><span id="userEmailTag" style="font-weight:700; color:var(--primary)">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span><span style="cursor:pointer;" onclick="toggleEmailDisplay()">üëÅÔ∏è</span></div>
            </div>
            <div class="id-card"><label style="font-size:10px; font-weight:800; color:var(--text-muted); text-transform:uppercase;">Account Status</label>
                <div style="color:var(--success); font-weight:700; margin-top:12px; font-size:16px;">‚úì Official Access Verified</div>
            </div>
        </div>

        <div class="actions-bar">
            <button class="btn" style="background:var(--success); color:white" onclick="document.getElementById('fileInput').click()">üìÅ Excel</button>
            <button class="btn" style="background:#6366f1; color:white" onclick="document.getElementById('pdfInput').click()">üìÑ Sync PDF</button>
            <button class="btn" style="background:var(--danger); color:white" onclick="clearDashboard()">üóëÔ∏è Clear</button>
            <button class="btn" style="background:#fff; border:1px solid var(--border)" onclick="logout()">üö™ Sign Out</button>
            <input type="file" id="fileInput" accept=".xlsx, .xls, .csv" style="display:none">
            <input type="file" id="pdfInput" accept=".pdf" style="display:none">
        </div>

        <div id="semContainer"></div>
        <div class="add-sem-area" onclick="addSemester()">+ INITIALIZE NEW ACADEMIC SEMESTER BLOCK</div>
    </div>
</div>

<script>
    const gradingPlan = [
        { min: 85, g: "A", p: 4.00, c: "#059669" }, { min: 80, g: "A-", p: 3.66, c: "#10b981" },
        { min: 75, g: "B+", p: 3.33, c: "#2563eb" }, { min: 71, g: "B", p: 3.00, c: "#3b82f6" },
        { min: 68, g: "B-", p: 2.66, c: "#1d4ed8" }, { min: 64, g: "C+", p: 2.33, c: "#ea580c" },
        { min: 61, g: "C", p: 2.00, c: "#f59e0b" }, { min: 58, g: "C-", p: 1.66, c: "#d97706" },
        { min: 54, g: "D+", p: 1.30, c: "#92400e" }, { min: 50, g: "D", p: 1.00, c: "#78350f" },
        { min: 0, g: "F", p: 0.00, c: "#dc2626" }
    ];

    let users = JSON.parse(localStorage.getItem('supGpaUsers')) || {};
    let activeEmail = sessionStorage.getItem('activeSupEmail');
    let semesterData = [];
    let isEmailVisible = false;

    // --- AUTH LOGIC ---
    function toggleAuthMode(m) { const p = document.getElementById('authPage'); if(m==='register'){p.classList.add('register-mode');document.getElementById('loginForm').style.display='none';document.getElementById('regForm').style.display='block';}else{p.classList.remove('register-mode');document.getElementById('loginForm').style.display='block';document.getElementById('regForm').style.display='none';}}
    function togglePass(id, el) { const i = document.getElementById(id); i.type = i.type === "password" ? "text" : "password"; el.innerText = i.type === "password" ? "üëÅÔ∏è" : "üîí"; }
    function toggleEmailDisplay() { isEmailVisible = !isEmailVisible; document.getElementById('userEmailTag').innerText = isEmailVisible ? activeEmail : "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"; }
    function handleAuth(t) {
        const e = document.getElementById(t==='login'?'loginEmail':'regEmail').value.trim().toLowerCase();
        const p = document.getElementById(t==='login'?'loginPass':'regPass').value;
        if(!e.endsWith('@superior.edu.pk')) return alert("Access Denied: @superior.edu.pk only!");
        if(t==='signup') { if(users[e]) return alert("Account exists!"); users[e] = { password: p, semesters: [] }; localStorage.setItem('supGpaUsers', JSON.stringify(users)); alert("Profile Initialized!"); toggleAuthMode('login'); }
        else { if(users[e] && users[e].password === p) { activeEmail = e; sessionStorage.setItem('activeSupEmail', e); initDashboard(); } else alert("Invalid Credentials!"); }
    }
    function initDashboard() { document.getElementById('authPage').style.display='none'; document.getElementById('mainDashboard').style.display='block'; semesterData = users[activeEmail].semesters || []; render(); }
    function logout() { sessionStorage.clear(); location.reload(); }
    function clearDashboard() { if(confirm('Erase all semester records?')) { semesterData = []; saveAndRender(); } }
    function saveAndRender() { if(activeEmail) { users[activeEmail].semesters = semesterData; localStorage.setItem('supGpaUsers', JSON.stringify(users)); render(); } }

    // --- CORE DUAL-MODE LOGIC ---
    function addSemester() { semesterData.push({ id: Date.now(), name: `Semester ${semesterData.length + 1}`, subjects: [] }); saveAndRender(); window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }); }
    function deleteSem(id) { semesterData = semesterData.filter(s => s.id !== id); saveAndRender(); }
    function addSubject(semId) { semesterData.find(s => s.id === semId).subjects.push({ id: Date.now()+Math.random(), title: '', ch: 3, simpleObt: 0, mode: 'simple', assessments: [{ type: 'Quiz', weight: 10, total: 40, obt: 0 }] }); saveAndRender(); }
    function switchMode(semId, subId, mode) { semesterData.find(s => s.id === semId).subjects.find(x => x.id === subId).mode = mode; saveAndRender(); }
    function updateAsm(semId, subId, asmIdx, field, val) { const sub = semesterData.find(s => s.id === semId).subjects.find(x => x.id === subId); sub.assessments[asmIdx][field] = field === 'type' ? val : parseFloat(val || 0); saveAndRender(); }

    function render() {
        const container = document.getElementById('semContainer');
        container.innerHTML = '';
        let totalQP = 0, totalCH = 0;

        semesterData.forEach((sem, sIdx) => {
            let semCH = 0, semQP = 0;
            const subjectsHtml = sem.subjects.map((sub, subIdx) => {
                let weightedPercentage = 0, subTotalWeight = 0;
                if (sub.mode === 'assessment') {
                    sub.assessments.forEach(a => { subTotalWeight += a.weight; if(a.total > 0) weightedPercentage += (a.obt / a.total) * a.weight; });
                } else { weightedPercentage = sub.simpleObt || 0; }

                const gradeObj = gradingPlan.find(p => weightedPercentage >= p.min) || gradingPlan[10];
                semCH += sub.ch; semQP += (gradeObj.p * sub.ch);

                const asmRows = sub.assessments.map((a, aIdx) => `
                    <tr>
                        <td>
                            <select class="input-minimal" onchange="updateAsm(${sem.id},${sub.id},${aIdx},'type',this.value)">
                                <option ${a.type==='Quiz'?'selected':''}>Quiz</option>
                                <option ${a.type==='Mid-Term'?'selected':''}>Mid-Term</option>
                                <option ${a.type==='Final'?'selected':''}>Final</option>
                                <option ${a.type==='Presentation'?'selected':''}>Presentation</option>
                                <option ${a.type==='Assignment'?'selected':''}>Assignment</option>
                                <option ${a.type==='Project'?'selected':''}>Project</option>
                                <option ${a.type==='Other'?'selected':''}>Other</option>
                            </select>
                        </td>
                        <td><input type="number" class="input-minimal" value="${a.weight}" onchange="updateAsm(${sem.id},${sub.id},${aIdx},'weight',this.value)"></td>
                        <td><input type="number" class="input-minimal" value="${a.total}" onchange="updateAsm(${sem.id},${sub.id},${aIdx},'total',this.value)"></td>
                        <td><input type="number" class="input-minimal" value="${a.obt}" onchange="updateAsm(${sem.id},${sub.id},${aIdx},'obt',this.value)"></td>
                        <td><button style="border:none; background:none; color:red; cursor:pointer;" onclick="sub.assessments.splice(${aIdx},1);saveAndRender()">‚úï</button></td>
                    </tr>`).join('');

                return `
                <div class="subject-block">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px;">
                        <input style="font-weight:800; font-size:18px; border:none; outline:none; background:none; width:60%;" value="${sub.title}" placeholder="Subject Name" onchange="semesterData[${sIdx}].subjects[${subIdx}].title=this.value;saveAndRender()">
                        <div class="mode-toggle">
                            <button class="mode-btn ${sub.mode==='simple'?'active':''}" onclick="switchMode(${sem.id},${sub.id},'simple')">Simple</button>
                            <button class="mode-btn ${sub.mode==='assessment'?'active':''}" onclick="switchMode(${sem.id},${sub.id},'assessment')">Assessment</button>
                        </div>
                        <div><label style="font-size:10px; font-weight:800;">CH:</label><input type="number" style="width:45px" class="input-minimal" value="${sub.ch}" onchange="semesterData[${sIdx}].subjects[${subIdx}].ch=parseFloat(this.value);saveAndRender()"></div>
                    </div>

                    ${sub.mode === 'simple' ? `
                        <div style="padding:10px 0;">
                            <label style="font-size:10px; font-weight:800; color:var(--text-muted);">TOTAL OBTAINED MARKS (0-100)</label>
                            <input type="number" class="input-minimal" style="margin-top:8px;" value="${sub.simpleObt}" onchange="semesterData[${sIdx}].subjects[${subIdx}].simpleObt=parseFloat(this.value);saveAndRender()">
                        </div>
                    ` : `
                        <div class="warning-banner" style="display: ${subTotalWeight !== 100 ? 'block' : 'none'}">‚ö†Ô∏è Total Weight: ${subTotalWeight}% (Target: 100%)</div>
                        <div class="table-wrap"><table><thead><tr><th>Type</th><th>Wtg %</th><th>Total</th><th>Obt</th><th></th></tr></thead><tbody>${asmRows}</tbody></table></div>
                        <button class="btn" style="background:#f1f5f9; color:var(--accent); font-weight:800; margin-top:15px;" onclick="semesterData.find(s=>s.id===${sem.id}).subjects.find(x=>x.id===${sub.id}).assessments.push({type:'Assignment',weight:10,total:40,obt:0});saveAndRender()">+ Add Assessment</button>
                    `}

                    <div style="display:flex; justify-content:flex-end; gap:20px; margin-top:20px; padding-top:15px; border-top:1px solid var(--border); font-weight:800;">
                        <span>Percentage: ${weightedPercentage.toFixed(1)}%</span>
                        <span style="color:var(--accent)">GPA: ${gradeObj.p.toFixed(2)}</span>
                        <button style="color:red; background:none; border:none; cursor:pointer;" onclick="semesterData[${sIdx}].subjects.splice(${subIdx},1);saveAndRender()">‚úï</button>
                    </div>
                </div>`;
            }).join('');

            const sgpa = semCH > 0 ? (semQP / semCH) : 0;
            totalCH += semCH; totalQP += semQP;
            const card = document.createElement('div'); card.className = 'sem-card';
            card.innerHTML = `
                <div class="sem-header"><div style="display:flex;align-items:center"><div style="background:var(--primary); color:white; width:40px; height:40px; display:flex; align-items:center; justify-content:center; border-radius:12px; font-weight:800">${sIdx+1}</div><input style="font-size:20px; font-weight:800; border:none; outline:none; margin-left:15px; background:none;" value="${sem.name}" onchange="semesterData[${sIdx}].name=this.value;saveAndRender()"></div><div style="background:#eff6ff; color:var(--accent); padding:10px 20px; border-radius:15px; font-weight:800">SGPA: ${sgpa.toFixed(2)}</div><button style="color:var(--danger); background:none; border:none; cursor:pointer; font-weight:700" onclick="deleteSem(${sem.id})">Delete Block</button></div>
                ${subjectsHtml}<button class="auth-btn" style="width:100%; background:var(--bg); color:var(--accent); border:2px dashed var(--border); margin-top:10px;" onclick="addSubject(${sem.id})">+ ADD SUBJECT ENTRY</button>`;
            container.appendChild(card);
        });
        document.getElementById('cgpaVal').innerText = (totalCH > 0 ? (totalQP / totalCH) : 0).toFixed(2);
        document.getElementById('degreeStatus').innerText = `Total Earned Credits: ${totalCH}`;
    }
    if(activeEmail) initDashboard();
</script>
</body>
</html> -->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super GPA Calc | Elite Academic Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        :root {
            --primary: #0f172a; --accent: #2563eb; --success: #059669;
            --danger: #dc2626; --bg: #f8fafc; --card: #ffffff;
            --text-main: #1e293b; --text-muted: #64748b; --border: #e2e8f0;
            --sup-blue: #1e3a8a; --sup-light: #3b82f6; --warning-bg: #fffbeb;
        }
        * { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        body { background: var(--bg); color: var(--text-main); margin: 0; padding: 0; overflow-x: hidden; }

        /* --- AUTH SYSTEM --- */
        #authPage { display: flex; min-height: 100vh; width: 100%; background: #fff; overflow: hidden; }
        .auth-side { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 5%; width: 100%; }
        .branding-side { background: linear-gradient(135deg, var(--sup-blue) 0%, var(--sup-light) 100%); color: white; text-align: left; align-items: flex-start; }
        .branding-content { max-width: 480px; }
        .branding-content h1 { font-size: clamp(2rem, 5vw, 3rem); font-weight: 800; margin-bottom: 20px; line-height: 1.1; letter-spacing: -2px; }
        .p-card { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.15); margin-bottom: 15px; }
        .p-card h4 { margin: 0 0 5px 0; font-size: 14px; }
        .p-card p { margin: 0; font-size: 11px; opacity: 0.8; }
        .auth-input { width: 100%; padding: 16px; border: 2px solid var(--border); border-radius: 20px; outline: none; margin-bottom: 15px; font-size: 15px; }
        .auth-btn { width: 100%; padding: 18px; background: var(--accent); color: white; border: none; border-radius: 20px; font-weight: 700; cursor: pointer; font-size: 16px; }
        .eye-toggle { position: absolute; right: 20px; bottom: 16px; cursor: pointer; color: var(--text-muted); font-size: 18px; }
        #authPage.register-mode { flex-direction: row-reverse; }

        /* --- DASHBOARD UI --- */
        #mainDashboard { display: none; padding: 40px 20px; }
        .container { max-width: 1250px; margin: 0 auto; display: flex; flex-direction: column; gap: 30px; }
        .glass-header { background: linear-gradient(135deg, var(--sup-blue) 0%, var(--sup-light) 100%); padding: 50px; border-radius: 45px; color: white; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; box-shadow: 0 35px 50px -15px rgba(30, 58, 138, 0.4); }
        .cgpa-val { font-size: clamp(40px, 8vw, 80px); font-weight: 800; letter-spacing: -4px; }

        /* Identity Cards */
        .identity-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .id-card { background: white; padding: 25px 30px; border-radius: 25px; border: 1px solid var(--border); box-shadow: 0 10px 20px rgba(0,0,0,0.02); }
        .email-display { display: flex; align-items: center; justify-content: space-between; background: #f1f5f9; padding: 12px 18px; border-radius: 18px; margin-top: 10px; }
        
        .actions-bar { display: flex; gap: 12px; flex-wrap: wrap; background: #fff; padding: 12px; border-radius: 20px; border: 1px solid var(--border); width: fit-content; }
        .btn { padding: 12px 24px; border-radius: 14px; border: none; font-weight: 700; cursor: pointer; font-size: 13px; }

        /* Subject Blocks */
        .sem-card { background: white; border-radius: 40px; padding: clamp(20px, 4vw, 40px); border: 1px solid var(--border); box-shadow: 0 15px 30px rgba(0,0,0,0.03); margin-bottom: 30px; }
        .subject-block { background: #fcfcfd; border: 1.5px solid var(--border); border-radius: 30px; padding: 25px; margin-bottom: 25px; position: relative; }
        
        .mode-toggle { display: flex; background: #f1f5f9; padding: 5px; border-radius: 12px; width: fit-content; }
        .mode-btn { padding: 8px 16px; border-radius: 8px; border: none; font-size: 12px; font-weight: 700; cursor: pointer; background: transparent; color: var(--text-muted); }
        .mode-btn.active { background: white; color: var(--accent); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        .table-wrap { overflow-x: auto; border-radius: 18px; background: white; margin-top: 15px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 750px; }
        th { text-align: left; font-size: 11px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; padding: 15px; border-bottom: 1px solid var(--border); }
        td { padding: 12px 15px; border-bottom: 1px solid #f1f5f9; }
        .input-minimal { width: 100%; padding: 10px; border: 1.5px solid var(--border); border-radius: 10px; outline: none; font-size: 13px; }
        
        .warning-banner { background: var(--warning-bg); color: #92400e; padding: 12px; border-radius: 12px; font-size: 12px; font-weight: 700; margin-bottom: 15px; border: 1px solid #fde68a; }
        .add-sem-area { border: 2px dashed var(--border); padding: 45px; border-radius: 35px; text-align: center; cursor: pointer; font-weight: 800; color: var(--text-muted); margin-bottom: 60px; }
        .add-sem-area:hover { border-color: var(--accent); color: var(--accent); background: white; }

        @media (max-width: 1024px) { #authPage { flex-direction: column !important; } .auth-side { padding: 40px 20px; } }
    </style>
</head>
<body>

<div id="authPage">
    <div class="auth-side branding-side">
        <div class="branding-content">
            <h1>Super GPA Calc.</h1>
            <p>Advanced tracking for Superior students. Accurate ERP sync and modern assessments.</p>
            <div class="p-card"><h4>‚ö° Quick Sync</h4><p>Import official result cards and PDF transcripts instantly.</p></div>
            <div class="p-card"><h4>üìä Precision Math</h4><p>Calculations strictly follow official portal grading logic.</p></div>
        </div>
    </div>
    <div class="auth-side form-side">
        <div class="form-container" id="loginForm">
            <h2 style="font-size: 32px; font-weight: 800; margin-bottom: 10px;">Sign In</h2>
            <input type="email" id="loginEmail" class="auth-input" placeholder="id@superior.edu.pk">
            <div class="input-group" style="position:relative"><input type="password" id="loginPass" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"><span class="eye-toggle" onclick="togglePass('loginPass', this)">üëÅÔ∏è</span></div>
            <button class="auth-btn" onclick="handleAuth('login')">Login to Portal</button>
            <p style="text-align: center; margin-top: 20px; font-size: 14px;">New? <span onclick="toggleAuthMode('register')" style="color:var(--accent); font-weight:800; cursor:pointer;">Register</span></p>
        </div>
        <div class="form-container" id="regForm" style="display: none;">
            <h2 style="font-size: 32px; font-weight: 800; margin-bottom: 10px;">Register</h2>
            <input type="email" id="regEmail" class="auth-input" placeholder="id@superior.edu.pk">
            <div class="input-group" style="position:relative"><input type="password" id="regPass" class="auth-input" placeholder="Min. 6 chars"><span class="eye-toggle" onclick="togglePass('regPass', this)">üëÅÔ∏è</span></div>
            <button class="auth-btn" style="background:var(--success)" onclick="handleAuth('signup')">Create Account</button>
            <p style="text-align: center; margin-top: 20px; font-size: 14px;">Have account? <span onclick="toggleAuthMode('login')" style="color:var(--accent); font-weight:800; cursor:pointer;">Login</span></p>
        </div>
    </div>
</div>

<div id="mainDashboard">
    <div class="container">
        <div class="glass-header">
            <div><h1 style="margin:0; font-size: clamp(24px, 4vw, 36px);">Super GPA Calc</h1><p style="opacity: 0.8; font-size: clamp(14px, 2vw, 18px);">Superior University Performance System</p></div>
            <div style="text-align: right;">
                <div style="font-size: 11px; font-weight: 800; text-transform: uppercase; opacity: 0.8; letter-spacing: 1px;">System CGPA</div>
                <div id="cgpaVal" class="cgpa-val">0.00</div>
                <div id="degreeStatus" style="font-size:13px; font-weight:700; background:rgba(255,255,255,0.2); padding:8px 18px; border-radius:30px; margin-top:10px; display:inline-block;">Credits: 0</div>
            </div>
        </div>

        <div class="identity-grid">
            <div class="id-card"><label style="font-size:10px; font-weight:800; color:var(--text-muted); text-transform:uppercase;">Active Student Email</label>
                <div class="email-display"><span id="userEmailTag" style="font-weight:700; color:var(--primary)">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span><span style="cursor:pointer;" onclick="toggleEmailDisplay()">üëÅÔ∏è</span></div>
            </div>
            <div class="id-card"><label style="font-size:10px; font-weight:800; color:var(--text-muted); text-transform:uppercase;">Account Status</label>
                <div style="color:var(--success); font-weight:700; margin-top:12px; font-size:16px;">‚úì Official Access Verified</div>
            </div>
        </div>

        <div class="actions-bar">
            <button class="btn" style="background:var(--success); color:white" onclick="document.getElementById('fileInput').click()">üìÅ Excel</button>
            <button class="btn" style="background:#6366f1; color:white" onclick="document.getElementById('pdfInput').click()">üìÑ Sync PDF</button>
            <button class="btn" style="background:var(--danger); color:white" onclick="clearDashboard()">üóëÔ∏è Clear</button>
            <button class="btn" style="background:#fff; border:1px solid var(--border)" onclick="logout()">üö™ Sign Out</button>
            <input type="file" id="fileInput" accept=".xlsx, .xls, .csv" style="display:none">
            <input type="file" id="pdfInput" accept=".pdf" style="display:none">
        </div>

        <div id="semContainer"></div>
        <div class="add-sem-area" onclick="addSemester()">+ INITIALIZE NEW ACADEMIC SEMESTER BLOCK</div>
    </div>
</div>

<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    const gradingPlan = [
        { min: 85, g: "A", p: 4.00, c: "#059669" }, { min: 80, g: "A-", p: 3.66, c: "#10b981" },
        { min: 75, g: "B+", p: 3.33, c: "#2563eb" }, { min: 71, g: "B", p: 3.00, c: "#3b82f6" },
        { min: 68, g: "B-", p: 2.66, c: "#1d4ed8" }, { min: 64, g: "C+", p: 2.33, c: "#ea580c" },
        { min: 61, g: "C", p: 2.00, c: "#f59e0b" }, { min: 58, g: "C-", p: 1.66, c: "#d97706" },
        { min: 54, g: "D+", p: 1.30, c: "#92400e" }, { min: 50, g: "D", p: 1.00, c: "#78350f" },
        { min: 0, g: "F", p: 0.00, c: "#dc2626" }
    ];

    const assessmentTypes = ["Quiz", "Mid-Term", "Final", "Presentation", "Assignment", "Project", "Other"];

    let users = JSON.parse(localStorage.getItem('supGpaUsers')) || {};
    let activeEmail = sessionStorage.getItem('activeSupEmail');
    let semesterData = [];
    let isEmailVisible = false;

    // --- PDF/EXCEL IMPORT LOGIC ---
    async function handlePdfUpload(e) {
        const file = e.target.files[0]; if (!file) return;
        const pdf = await pdfjsLib.getDocument(new Uint8Array(await file.arrayBuffer())).promise;
        let fullText = "";
        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const content = await page.getTextContent();
            fullText += content.items.map(s => s.str).join(" ") + " ";
        }
        const sections = fullText.split(/Term:\s+/);
        sections.slice(1).forEach(section => {
            const words = section.trim().split(" ");
            const semester = { id: Date.now()+Math.random(), name: words[0]+" "+words[1], subjects: [] };
            const rowRegex = /(\d+)\s+([A-Z0-9]{6,12})\s+(.+?)\s+(\d\.\d{2})\s+(\d+)\s+(\d+)\s+([A-F][+-]?)/g;
            let m; while ((m = rowRegex.exec(section)) !== null) {
                if (!m[3].includes("Course Title")) {
                    semester.subjects.push({ 
                        id: Date.now()+Math.random(), title: m[3].trim(), ch: parseFloat(m[4]), 
                        simpleObt: parseFloat(m[6]), mode: 'simple', 
                        assessments: [{ type: 'Final', weight: 100, total: 100, obt: parseFloat(m[6]) }] 
                    });
                }
            }
            if (semester.subjects.length > 0) semesterData.push(semester);
        });
        saveAndRender();
        alert("PDF Data Imported Successfully!");
    }

    // --- AUTH LOGIC ---
    function toggleAuthMode(m) { const p = document.getElementById('authPage'); if(m==='register'){p.classList.add('register-mode');document.getElementById('loginForm').style.display='none';document.getElementById('regForm').style.display='block';}else{p.classList.remove('register-mode');document.getElementById('loginForm').style.display='block';document.getElementById('regForm').style.display='none';}}
    function togglePass(id, el) { const i = document.getElementById(id); i.type = i.type === "password" ? "text" : "password"; el.innerText = i.type === "password" ? "üëÅÔ∏è" : "üîí"; }
    function toggleEmailDisplay() { isEmailVisible = !isEmailVisible; document.getElementById('userEmailTag').innerText = isEmailVisible ? activeEmail : "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"; }
    
    function handleAuth(t) {
        const e = document.getElementById(t==='login'?'loginEmail':'regEmail').value.trim().toLowerCase();
        const p = document.getElementById(t==='login'?'loginPass':'regPass').value;
        if(!e.endsWith('@superior.edu.pk')) return alert("Access Denied: @superior.edu.pk only!");
        if(t==='signup') { if(users[e]) return alert("Account exists!"); users[e] = { password: p, semesters: [] }; localStorage.setItem('supGpaUsers', JSON.stringify(users)); alert("Account Created!"); toggleAuthMode('login'); }
        else { if(users[e] && users[e].password === p) { activeEmail = e; sessionStorage.setItem('activeSupEmail', e); initDashboard(); } else alert("Invalid Credentials!"); }
    }

    function initDashboard() {
        document.getElementById('authPage').style.display = 'none';
        document.getElementById('mainDashboard').style.display = 'block';
        semesterData = users[activeEmail].semesters || [];
        render();
    }

    function logout() { sessionStorage.clear(); location.reload(); }
    function clearDashboard() { if(confirm('Erase everything?')) { semesterData = []; saveAndRender(); } }
    function saveAndRender() { if(activeEmail) { users[activeEmail].semesters = semesterData; localStorage.setItem('supGpaUsers', JSON.stringify(users)); render(); } }

    // --- CORE LOGIC ---
    function addSemester() { semesterData.push({ id: Date.now(), name: `Semester ${semesterData.length + 1}`, subjects: [] }); saveAndRender(); window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }); }
    function deleteSem(id) { semesterData = semesterData.filter(s => s.id !== id); saveAndRender(); }
    function addSubject(semId) { semesterData.find(s => s.id === semId).subjects.push({ id: Date.now()+Math.random(), title: '', ch: 3, simpleObt: 0, mode: 'simple', assessments: [{ type: 'Quiz', weight: 10, total: 40, obt: 0 }] }); saveAndRender(); }
    function switchMode(semId, subId, mode) { semesterData.find(s => s.id === semId).subjects.find(x => x.id === subId).mode = mode; saveAndRender(); }
    function updateAsm(semId, subId, asmIdx, field, val) { const sub = semesterData.find(s => s.id === semId).subjects.find(x => x.id === subId); sub.assessments[asmIdx][field] = field === 'type' ? val : parseFloat(val || 0); saveAndRender(); }

    function render() {
        const container = document.getElementById('semContainer');
        container.innerHTML = '';
        let totalQP = 0, totalCH = 0;

        semesterData.forEach((sem, sIdx) => {
            let semCH = 0, semQP = 0;
            const subjectsHtml = sem.subjects.map((sub, subIdx) => {
                let weightedPercentage = 0, subTotalWeight = 0;
                if (sub.mode === 'assessment') {
                    sub.assessments.forEach(a => { subTotalWeight += a.weight; if(a.total > 0) weightedPercentage += (a.obt / a.total) * a.weight; });
                } else { weightedPercentage = sub.simpleObt || 0; }

                const gradeObj = gradingPlan.find(p => weightedPercentage >= p.min) || gradingPlan[10];
                semCH += sub.ch; semQP += (gradeObj.p * sub.ch);

                const asmRows = sub.assessments.map((a, aIdx) => `
                    <tr>
                        <td>
                            <select class="input-minimal" onchange="updateAsm(${sem.id},${sub.id},${aIdx},'type',this.value)">
                                ${assessmentTypes.map(opt => `<option value="${opt}" ${a.type===opt?'selected':''}>${opt}</option>`).join('')}
                            </select>
                        </td>
                        <td><input type="number" class="input-minimal" value="${a.weight}" onchange="updateAsm(${sem.id},${sub.id},${aIdx},'weight',this.value)"></td>
                        <td><input type="number" class="input-minimal" value="${a.total}" onchange="updateAsm(${sem.id},${sub.id},${aIdx},'total',this.value)"></td>
                        <td><input type="number" class="input-minimal" value="${a.obt}" onchange="updateAsm(${sem.id},${sub.id},${aIdx},'obt',this.value)"></td>
                        <td><button style="border:none; background:none; color:red; cursor:pointer;" onclick="sub.assessments.splice(${aIdx},1);saveAndRender()">‚úï</button></td>
                    </tr>`).join('');

                return `
                <div class="subject-block">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px;">
                        <input style="font-weight:800; font-size:18px; border:none; outline:none; background:none; width:60%;" value="${sub.title}" placeholder="Subject Name" onchange="semesterData[${sIdx}].subjects[${subIdx}].title=this.value;saveAndRender()">
                        <div class="mode-toggle">
                            <button class="mode-btn ${sub.mode==='simple'?'active':''}" onclick="switchMode(${sem.id},${sub.id},'simple')">Simple</button>
                            <button class="mode-btn ${sub.mode==='assessment'?'active':''}" onclick="switchMode(${sem.id},${sub.id},'assessment')">Assessment</button>
                        </div>
                        <div><label style="font-size:10px; font-weight:800;">CH:</label><input type="number" style="width:45px" class="input-minimal" value="${sub.ch}" onchange="semesterData[${sIdx}].subjects[${subIdx}].ch=parseFloat(this.value);saveAndRender()"></div>
                    </div>
                    ${sub.mode === 'simple' ? `<div style="padding:10px 0;"><label style="font-size:10px; font-weight:800; color:var(--text-muted);">TOTAL OBTAINED MARKS (0-100)</label><input type="number" class="input-minimal" style="margin-top:8px;" value="${sub.simpleObt}" onchange="semesterData[${sIdx}].subjects[${subIdx}].simpleObt=parseFloat(this.value);saveAndRender()"></div>` : `
                        <div class="warning-banner" style="display: ${subTotalWeight !== 100 ? 'block' : 'none'}">‚ö†Ô∏è Total Weight: ${subTotalWeight}% (Target: 100%)</div>
                        <div class="table-wrap"><table><thead><tr><th>Type</th><th>Wtg %</th><th>Total</th><th>Obt</th><th></th></tr></thead><tbody>${asmRows}</tbody></table></div>
                        <button class="btn" style="background:#f1f5f9; color:var(--accent); font-weight:800; margin-top:15px;" onclick="semesterData.find(s=>s.id===${sem.id}).subjects.find(x=>x.id===${sub.id}).assessments.push({type:'Assignment',weight:10,total:40,obt:0});saveAndRender()">+ Add Assessment</button>
                    `}
                    <div style="display:flex; justify-content:flex-end; gap:20px; margin-top:20px; padding-top:15px; border-top:1px solid var(--border); font-weight:800;">
                        <span>Percentage: ${weightedPercentage.toFixed(1)}%</span>
                        <span style="color:var(--accent)">GPA: ${gradeObj.p.toFixed(2)}</span>
                        <button style="color:red; background:none; border:none; cursor:pointer;" onclick="semesterData[${sIdx}].subjects.splice(${subIdx},1);saveAndRender()">‚úï</button>
                    </div>
                </div>`;
            }).join('');

            const sgpa = semCH > 0 ? (semQP / semCH) : 0;
            totalCH += semCH; totalQP += semQP;
            const card = document.createElement('div'); card.className = 'sem-card';
            card.innerHTML = `<div class="sem-header"><div style="display:flex;align-items:center"><div style="background:var(--primary); color:white; width:40px; height:40px; display:flex; align-items:center; justify-content:center; border-radius:12px; font-weight:800">${sIdx+1}</div><input style="font-size:20px; font-weight:800; border:none; outline:none; margin-left:15px; background:none;" value="${sem.name}" onchange="semesterData[${sIdx}].name=this.value;saveAndRender()"></div><div style="background:#eff6ff; color:var(--accent); padding:10px 20px; border-radius:15px; font-weight:800">SGPA: ${sgpa.toFixed(2)}</div><button style="color:var(--danger); background:none; border:none; cursor:pointer; font-weight:700" onclick="deleteSem(${sem.id})">Delete</button></div>
                ${subjectsHtml}<button class="auth-btn" style="width:100%; background:var(--bg); color:var(--accent); border:2px dashed var(--border); margin-top:10px;" onclick="addSubject(${sem.id})">+ ADD SUBJECT ENTRY</button>`;
            container.appendChild(card);
        });
        document.getElementById('cgpaVal').innerText = (totalCH > 0 ? (totalQP / totalCH) : 0).toFixed(2);
        document.getElementById('degreeStatus').innerText = `Total Earned Credits: ${totalCH}`;
    }

    document.getElementById('pdfInput').addEventListener('change', handlePdfUpload);
    if(activeEmail) initDashboard();
</script>
</body>
</html>